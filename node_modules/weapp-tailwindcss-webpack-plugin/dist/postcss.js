'use strict';

var defaults = require('./defaults-464f242a.js');
var constants = require('./constants-ff495628.js');
require('./utils-17c91589.js');
require('micromatch');
require('@babel/generator');
require('@babel/parser');
require('@babel/traverse');
require('postcss');
require('postcss-selector-parser');
require('path');
require('fs');
require('semver');

const plugin = (options = {}) => {
    const mergedOptions = defaults.getOptions(options);
    const { classGenerator } = options;
    const { cssPreflight, cssPreflightRange, customRuleCallback, replaceUniversalSelectorWith } = mergedOptions;
    const cssInjectPreflight = defaults.createInjectPreflight(cssPreflight);
    const opts = {
        cssInjectPreflight,
        cssPreflightRange,
        isMainChunk: true,
        customRuleCallback,
        replaceUniversalSelectorWith,
        classGenerator
    };
    return {
        postcssPlugin: constants.postcssPlugin,
        Once(css) {
            css.walkRules((rule) => {
                defaults.transformSync(rule, opts);
                defaults.commonChunkPreflight(rule, opts);
            });
        }
    };
};
plugin.postcss = true;

module.exports = plugin;
